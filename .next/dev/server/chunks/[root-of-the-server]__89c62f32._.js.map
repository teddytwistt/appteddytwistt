{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/fausti/Downloads/teddyTwist/nuevos-cambios-gonzalo/lib/supabase/server-admin.ts"],"sourcesContent":["import { createClient as createSupabaseClient } from \"@supabase/supabase-js\"\n\n// Server-side admin client that bypasses RLS policies\n// Use this ONLY for trusted server-side operations\nexport async function createAdminClient() {\n  const supabaseUrl = process.env.SUPABASE_URL\n  const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n  if (!supabaseUrl || !supabaseServiceKey) {\n    throw new Error(\"Missing Supabase environment variables for admin client\")\n  }\n\n  return createSupabaseClient(supabaseUrl, supabaseServiceKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;;AAIO,eAAe;IACpB,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;IAC5C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;IAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACvC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,yLAAoB,EAAC,aAAa,oBAAoB;QAC3D,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///Users/fausti/Downloads/teddyTwist/nuevos-cambios-gonzalo/app/api/stock/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { createAdminClient } from \"@/lib/supabase/server-admin\"\n\nconst PRODUCTO_ID = 1 // ID del producto Buzzy Twist\n\nexport async function GET() {\n  try {\n    const supabase = await createAdminClient()\n\n    // Obtener información del producto\n    const { data: producto, error: errorProducto } = await supabase\n      .from(\"productos\")\n      .select(\"*\")\n      .eq(\"id\", PRODUCTO_ID)\n      .single()\n\n    if (errorProducto) {\n      console.error(\"[stock] Error fetching product:\", errorProducto)\n      return NextResponse.json({ error: \"Error al obtener producto\" }, { status: 500 })\n    }\n\n    // Obtener stock usando la función\n    const { data: stockData, error: errorStock } = await supabase.rpc(\"obtener_stock_disponible\", {\n      p_id_producto: PRODUCTO_ID,\n    })\n\n    if (errorStock || !stockData || stockData.length === 0) {\n      console.error(\"[stock] Error fetching stock:\", errorStock)\n      return NextResponse.json({ error: \"Error al obtener stock\" }, { status: 500 })\n    }\n\n    const stock = stockData[0]\n\n    return NextResponse.json({\n      id: PRODUCTO_ID,\n      nombre: producto.nombre,\n      stock_inicial: stock.stock_inicial,\n      vendidos: Number(stock.vendidos),\n      disponibles: Number(stock.disponibles),\n      activo: producto.activo,\n    })\n  } catch (error) {\n    console.error(\"[stock] Stock error:\", error)\n    return NextResponse.json({ error: \"Error al obtener stock\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,cAAc,EAAE,8BAA8B;;AAE7C,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yJAAiB;QAExC,mCAAmC;QACnC,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,aACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,aACT,MAAM;QAET,IAAI,eAAe;YACjB,QAAQ,KAAK,CAAC,mCAAmC;YACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,kCAAkC;QAClC,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,4BAA4B;YAC5F,eAAe;QACjB;QAEA,IAAI,cAAc,CAAC,aAAa,UAAU,MAAM,KAAK,GAAG;YACtD,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,QAAQ,SAAS,CAAC,EAAE;QAE1B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,QAAQ,SAAS,MAAM;YACvB,eAAe,MAAM,aAAa;YAClC,UAAU,OAAO,MAAM,QAAQ;YAC/B,aAAa,OAAO,MAAM,WAAW;YACrC,QAAQ,SAAS,MAAM;QACzB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF"}}]
}