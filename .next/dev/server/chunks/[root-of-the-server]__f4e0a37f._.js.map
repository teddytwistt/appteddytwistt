{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/fausti/Downloads/nuevos-cambios-gonzalo/lib/supabase/server-admin.ts"],"sourcesContent":["import { createClient as createSupabaseClient } from \"@supabase/supabase-js\"\n\n// Server-side admin client that bypasses RLS policies\n// Use this ONLY for trusted server-side operations\nexport async function createAdminClient() {\n  const supabaseUrl = process.env.SUPABASE_URL\n  const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n  if (!supabaseUrl || !supabaseServiceKey) {\n    throw new Error(\"Missing Supabase environment variables for admin client\")\n  }\n\n  return createSupabaseClient(supabaseUrl, supabaseServiceKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;;AAIO,eAAe;IACpB,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;IAC5C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;IAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACvC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,yLAAoB,EAAC,aAAa,oBAAoB;QAC3D,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///Users/fausti/Downloads/nuevos-cambios-gonzalo/app/api/get-next-serial/route.ts"],"sourcesContent":["import { createAdminClient } from \"@/lib/supabase/server-admin\"\nimport { NextResponse } from \"next/server\"\n\nconst PRODUCTO_ID = 1 // ID del producto Buzzy Twist\n\nexport async function GET() {\n  try {\n    const supabase = await createAdminClient()\n\n    // Obtener la primera unidad disponible (para preview)\n    const { data: unidad, error: unidadError } = await supabase\n      .from(\"unidades_producto\")\n      .select(\"numero_serie\")\n      .eq(\"id_producto\", PRODUCTO_ID)\n      .eq(\"estado\", \"disponible\")\n      .order(\"numero_serie\")\n      .limit(1)\n      .single()\n\n    if (unidadError || !unidad) {\n      console.error(\"[get-next-serial] Error fetching next unit:\", unidadError)\n      return NextResponse.json({ error: \"No hay unidades disponibles\" }, { status: 404 })\n    }\n\n    // Obtener stock total\n    const { data: producto, error: productoError } = await supabase\n      .from(\"productos\")\n      .select(\"stock_inicial\")\n      .eq(\"id\", PRODUCTO_ID)\n      .single()\n\n    if (productoError) {\n      console.error(\"[get-next-serial] Error fetching product:\", productoError)\n      return NextResponse.json({ error: \"Error fetching product data\" }, { status: 500 })\n    }\n\n    const totalStock = producto?.stock_inicial || 900\n    const nextSerial = unidad.numero_serie\n    const formattedSerial = String(nextSerial).padStart(3, \"0\")\n    const serialNumber = `${formattedSerial}/${totalStock}`\n\n    return NextResponse.json({\n      serialNumber: serialNumber,\n      nextSerial: nextSerial,\n      totalStock: totalStock,\n    })\n  } catch (error) {\n    console.error(\"[get-next-serial] Error in get-next-serial:\", error)\n    return NextResponse.json(\n      { error: \"Internal server error\", details: error instanceof Error ? error.message : \"Unknown error\" },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,cAAc,EAAE,8BAA8B;;AAE7C,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yJAAiB;QAExC,sDAAsD;QACtD,MAAM,EAAE,MAAM,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAChD,IAAI,CAAC,qBACL,MAAM,CAAC,gBACP,EAAE,CAAC,eAAe,aAClB,EAAE,CAAC,UAAU,cACb,KAAK,CAAC,gBACN,KAAK,CAAC,GACN,MAAM;QAET,IAAI,eAAe,CAAC,QAAQ;YAC1B,QAAQ,KAAK,CAAC,+CAA+C;YAC7D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,sBAAsB;QACtB,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,aACL,MAAM,CAAC,iBACP,EAAE,CAAC,MAAM,aACT,MAAM;QAET,IAAI,eAAe;YACjB,QAAQ,KAAK,CAAC,6CAA6C;YAC3D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,aAAa,UAAU,iBAAiB;QAC9C,MAAM,aAAa,OAAO,YAAY;QACtC,MAAM,kBAAkB,OAAO,YAAY,QAAQ,CAAC,GAAG;QACvD,MAAM,eAAe,GAAG,gBAAgB,CAAC,EAAE,YAAY;QAEvD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,cAAc;YACd,YAAY;YACZ,YAAY;QACd;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAyB,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB,GACpG;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}